<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>H√ÑNGA GUBBE</title>

  <!-- Fonts & Firebase -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>

  <style>
    :root {
      --grad-a: #ec4899;
      --grad-b: #a855f7;
      --bg1: #0e0e11;
      --bg2: #1a1a1f;
      --panel: rgba(255,255,255,0.08);
      --text: #fff;
      --text-dim: #bdbdbd;
    }

    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      color: var(--text);
      background: radial-gradient(circle at 20% 20%, #18181d, #0e0e11 70%), linear-gradient(160deg, var(--bg1), var(--bg2));
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100dvh;
      overflow: hidden;
    }

    h1 {
      font-weight: 700;
      text-align: center;
      background: linear-gradient(135deg, var(--grad-a), var(--grad-b));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0 0 12px;
    }

    .card {
      background: var(--panel);
      border-radius: 18px;
      backdrop-filter: blur(12px);
      box-shadow: 0 0 25px rgba(0,0,0,0.6);
      width: min(720px, 96vw);
      padding: 20px;
      text-align: center;
    }

    input, button, select {
      font-family: inherit;
      border-radius: 10px;
      border: 1px solid #333;
      padding: 0.7rem 1rem;
      font-size: 1rem;
    }

    input {
      width: 100%;
      background: #222;
      color: #fff;
    }

    button {
      cursor: pointer;
      font-weight: 600;
      background: linear-gradient(135deg, var(--grad-a), var(--grad-b));
      border: none;
      color: #111;
      box-shadow: 0 6px 18px rgba(168,85,247,.25);
      transition: transform 0.15s ease;
    }

    button:hover {
      transform: translateY(-2px);
    }

    .hidden { display: none; }
    #game { display: none; }

    #letters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(34px, 1fr));
      gap: 6px;
      margin-top: 10px;
    }

    #letters button {
      background: linear-gradient(135deg, var(--grad-a), var(--grad-b));
      border: none;
      color: #111;
      font-weight: 700;
      border-radius: 8px;
      padding: .5rem;
    }

    #chat {
      margin-top: 10px;
      border-radius: 10px;
      background: rgba(255,255,255,.05);
      padding: 8px;
      max-height: 140px;
      overflow-y: auto;
      font-size: .9rem;
      text-align: left;
    }

    #turnIndicator {
      margin-top: 8px;
      font-weight: 600;
      color: var(--text-dim);
    }

    #share {
      margin-top: 6px;
      font-size: .9rem;
      color: var(--text-dim);
      word-break: break-all;
    }

    #scoreboard {
      margin-top: 8px;
      font-weight: 600;
      background: linear-gradient(135deg, var(--grad-a), var(--grad-b));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    canvas { background: #111; border-radius: 10px; margin-top: 10px; width: 100%; aspect-ratio: 4/3; }
  </style>
</head>

<body>
  <!-- Start screen -->
  <div id="start" class="card">
    <h1>H√ÑNGA GUBBE</h1>
    <div>
      <label for="lang">Spr√•k / Language:</label>
      <select id="lang">
        <option value="sv">Svenska</option>
        <option value="en">English</option>
      </select>
    </div>
    <br>
    <div>
      <input id="playerName" placeholder="Ditt namn / Your name" />
    </div>
    <br>
    <button id="createBtn">üÜï Skapa spel</button>
    <br><br>
    <div>
      <input id="joinCode" placeholder="Spelkod (t.ex. ab123)" />
      <button id="joinBtn">üîó G√• med i spel</button>
    </div>
  </div>

  <!-- Game screen -->
  <div id="game" class="card">
    <h1>H√ÑNGA GUBBE</h1>
    <div id="turnIndicator">‚è≥ V√§ntar p√• tur...</div>
    <div id="share"></div>
    <div id="scoreboard">üßë 0 | üë§ 0</div>
    <canvas id="hangman"></canvas>
    <div id="word">_</div>
    <div id="letters"></div>
    <div id="chat"></div>
    <button id="restartBtn" class="hidden">üîÅ Spela igen</button>
  </div>

  <script>
  // --- Firebase init ---
  const firebaseConfig = {
    apiKey: "AIzaSyAN9URR47HIBwIuBP3kSu5Rv_Ys0ef72-Q",
    authDomain: "hangman-6a99e.firebaseapp.com",
    databaseURL: "https://hangman-6a99e-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "hangman-6a99e",
    storageBucket: "hangman-6a99e.firebasestorage.app",
    messagingSenderId: "992689481911",
    appId: "1:992689481911:web:6461e931ba4d96879ec532",
    measurementId: "G-W1HFVTC23L"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const startDiv = document.getElementById("start");
  const gameDiv = document.getElementById("game");
  const playerNameInput = document.getElementById("playerName");
  const joinCodeInput = document.getElementById("joinCode");
  const langSelect = document.getElementById("lang");
  const createBtn = document.getElementById("createBtn");
  const joinBtn = document.getElementById("joinBtn");

  const turnEl = document.getElementById("turnIndicator");
  const shareEl = document.getElementById("share");
  const wordDiv = document.getElementById("word");
  const lettersDiv = document.getElementById("letters");
  const chatDiv = document.getElementById("chat");
  const scoreEl = document.getElementById("scoreboard");

  let isHost = false;
  let nickname = "";
  let gameId = "";
  let lang = "sv";

  const letters = [..."ABCDEFGHIJKLMNOPQRSTUVWXYZ√Ö√Ñ√ñ"];
  let currentWrong = 0;

  createBtn.onclick = async () => {
    nickname = playerNameInput.value.trim() || "V√§rd";
    lang = langSelect.value;
    const word = prompt(lang === "sv" ? "Ange ett ord att spela med:" : "Enter a word to start:");
    if (!word) return;
    const id = "hangman-" + Math.random().toString(36).substr(2,5);
    await db.ref("games/" + id).set({
      word: word.toUpperCase(),
      guesses: [],
      wrong: 0,
      over: false,
      players: { host: nickname },
      turn: "guest",
      scores: { host: 0, guest: 0 }
    });
    isHost = true;
    gameId = id;
    startGame();
  };

  joinBtn.onclick = async () => {
    nickname = playerNameInput.value.trim() || "G√§st";
    lang = langSelect.value;
    const code = joinCodeInput.value.trim();
    if (!code) return alert("Ange spelkod.");
    const id = "hangman-" + code;
    const snap = await db.ref("games/" + id).get();
    if (!snap.exists()) return alert("Spelet hittades inte.");
    await db.ref("games/" + id + "/players").update({ guest: nickname });
    isHost = false;
    gameId = id;
    startGame();
  };

  function startGame() {
    startDiv.style.display = "none";
    gameDiv.style.display = "block";
    createLetterButtons();
    listenGame();
    const link = `${location.origin}${location.pathname}?game=${gameId}`;
    shareEl.innerHTML = (lang==="sv" ? "Dela denna l√§nk: " : "Share this link: ") + `<a href="${link}" target="_blank">${link}</a>`;
  }

  function createLetterButtons() {
    lettersDiv.innerHTML = "";
    letters.forEach(ch => {
      const b = document.createElement("button");
      b.textContent = ch;
      b.onclick = async () => {
        const snap = await db.ref("games/" + gameId).get();
        const d = snap.val();
        if (!d || d.over) return;
        const myRole = isHost ? "host" : "guest";
        if (d.turn !== myRole) return alert(lang==="sv"?"Inte din tur!":"Not your turn!");
        const guesses = d.guesses || [];
        if (guesses.includes(ch)) return;
        let newGuesses = [...guesses, ch];
        let newWrong = d.wrong || 0;
        let over = false;
        let winner = null;
        const scores = d.scores || {host:0, guest:0};
        if (!d.word.includes(ch)) newWrong++;
        const solved = d.word.split("").every(l => newGuesses.includes(l));
        if (solved) { over = true; winner = d.turn; scores[winner]++; }
        else if (newWrong >= 6) { over = true; winner = d.turn==="host"?"guest":"host"; scores[winner]++; }
        await db.ref("games/" + gameId).update({ guesses:newGuesses, wrong:newWrong, over, scores, winner });
      };
      lettersDiv.appendChild(b);
    });
  }

  function showWord(word, guesses) {
    wordDiv.textContent = word.split("").map(l => guesses.includes(l)?l:"_").join(" ");
  }

  function updateTurnIndicator(turn) {
    if ((isHost && turn === "host") || (!isHost && turn === "guest"))
      turnEl.textContent = lang==="sv" ? "üéØ Din tur!" : "üéØ Your turn!";
    else
      turnEl.textContent = lang==="sv" ? "‚è≥ Motst√•ndarens tur..." : "‚è≥ Opponent's turn...";
  }

  function listenGame() {
    db.ref("games/" + gameId).on("value", snap => {
      const d = snap.val() || {};
      showWord(d.word || "", d.guesses || []);
      updateTurnIndicator(d.turn);
      scoreEl.textContent = `üßë ${d.scores?.host||0} | üë§ ${d.scores?.guest||0}`;
      const allBtns = lettersDiv.querySelectorAll("button");
      allBtns.forEach(b => b.disabled = (d.guesses||[]).includes(b.textContent));
      if (d.over && d.winner) {
        const msg = (lang==="sv")
          ? (d.winner==="host"?"üéâ V√§rden vann!":"üéâ G√§sten vann!")
          : (d.winner==="host"?"üéâ Host won!":"üéâ Guest won!");
        chatDiv.innerHTML = `<div>${msg}</div>`;
      }
    });
  }
  </script>
</body>
</html>
