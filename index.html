<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>H√§nga gubbe ‚Äî Multiplayer</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f4f4f4;
      padding: 20px;
    }

    #word {
      font-size: 6vw;
      letter-spacing: 0.5em;
      margin: 20px 0;
      word-wrap: break-word;
    }

    #letters {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 5px;
      margin: 10px 0;
    }

    #letters button {
      padding: 1rem;
      font-size: 1.2rem;
      min-width: 40px;
      flex: 1 1 40px;
      border-radius: 8px;
    }

    #message {
      font-size: 5vw;
      margin: 15px 0;
    }

    #link {
      margin: 10px 0;
      color: blue;
      word-break: break-word;
    }

    input, button {
      font-size: 1.2rem;
      padding: 0.8rem;
      border-radius: 8px;
      margin: 5px;
    }

    #hangman {
      width: 80%;
      max-width: 300px;
      height: auto;
      aspect-ratio: 200/250;
      margin: 20px auto;
      border: 1px solid #ccc;
      background: white;
    }

    #restartBtn, #newWordBtn {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 1rem;
      display: none;
    }

    #lobby {
      margin-top: 15px;
      font-size: 1.1rem;
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 4px rgba(0,0,0,0.1);
      max-width: 320px;
      margin-left: auto;
      margin-right: auto;
    }

    #turnIndicator {
      font-size: 1.3rem;
      font-weight: bold;
      margin-bottom: 10px;
      transition: all 0.3s ease;
    }

    /* üëÄ blinking eyes animation */
    .blink {
      animation: blink 1.5s infinite;
    }

    @keyframes blink {
      0%, 90%, 100% { opacity: 1; }
      95% { opacity: 0.2; }
    }

    @media (max-width: 600px) {
      #word {
        font-size: 8vw;
        letter-spacing: 0.3em;
      }
      #letters button {
        padding: 0.6rem;
        font-size: 1rem;
      }
      #hangman {
        width: 90%;
        max-width: 250px;
      }
    }
  </style>
</head>
<body>
  <h1>üá∏üá™ H√§nga gubbe ‚Äî Multiplayer</h1>

  <div id="setup">
    <input id="wordInput" placeholder="Skriv ett ord..." />
    <button id="createBtn">Skapa spel</button>
  </div>

  <div id="game" style="display:none;">
    <canvas id="hangman"></canvas>
    <div id="word"></div>
    <div id="turnIndicator"></div>
    <div id="letters"></div>
    <div id="message"></div>
    <div id="lobby"></div>
    <p id="link"></p>
    <button id="restartBtn">üîÅ Spela igen</button>
    <button id="newWordBtn">‚úçÔ∏è V√§lj nytt ord</button>
  </div>

  <script>
  window.onload = () => {

    // üî• Firebase setup (replace with your own)
    const firebaseConfig = {
  apiKey: "AIzaSyAN9URR47HIBwIuBP3kSu5Rv_Ys0ef72-Q",
  authDomain: "hangman-6a99e.firebaseapp.com",
  databaseURL: "https://hangman-6a99e-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "hangman-6a99e",
  storageBucket: "hangman-6a99e.firebasestorage.app",
  messagingSenderId: "992689481911",
  appId: "1:992689481911:web:6461e931ba4d96879ec532",
  measurementId: "G-W1HFVTC23L"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const setup = document.getElementById("setup");
    const gameDiv = document.getElementById("game");
    const wordDiv = document.getElementById("word");
    const lettersDiv = document.getElementById("letters");
    const msg = document.getElementById("message");
    const lobbyDiv = document.getElementById("lobby");
    const linkEl = document.getElementById("link");
    const restartBtn = document.getElementById("restartBtn");
    const newWordBtn = document.getElementById("newWordBtn");
    const turnIndicator = document.getElementById("turnIndicator");
    const canvas = document.getElementById("hangman");
    const ctx = canvas.getContext("2d");

    const urlParams = new URLSearchParams(window.location.search);
    const gameId = urlParams.get("game");
    const letters = [..."ABCDEFGHIJKLMNOPQRSTUVWXYZ√Ö√Ñ√ñ"];

    let nickname = "Axwell"; // default for host
    let isHost = false;

    // üß≠ Host creates game
    document.getElementById("createBtn").onclick = async () => {
      const word = document.getElementById("wordInput").value.toUpperCase();
      if (!word.match(/^[A-Z√Ö√Ñ√ñ]+$/)) return alert("Endast bokst√§ver (A-√ñ) till√•tna!");
      const id = "hangman-" + Math.random().toString(36).substr(2,5);
      await db.ref("games/" + id).set({
        word,
        guesses: [],
        wrong: 0,
        over: false,
        players: { host: "Axwell" },
        turn: "guest"
      });
      window.location.href = `${location.origin}${location.pathname}?game=${id}`;
    };

    // üéÆ Join game
    if (gameId) {
      setup.style.display = "none";
      gameDiv.style.display = "block";
      db.ref("games/" + gameId).get().then(async snap => {
        if (!snap.exists()) return (msg.textContent = "‚ùå Spelet kunde inte hittas.");
        const data = snap.val();
        isHost = data.players?.host === "Axwell" && !data.players?.guest;
        if (!isHost) {
          nickname = prompt("Ange ditt namn:") || "G√§st";
          await db.ref("games/" + gameId + "/players/guest").set(nickname);
        }
        startGame(gameId);
      });
    }

    function startGame(id) {
      db.ref("games/" + id).get().then(snap => {
        if (!snap.exists()) return (msg.textContent = "‚ùå Spelet kunde inte hittas.");
        const data = snap.val();
        showWord(data.word, data.guesses);
        createLetterButtons(id);
        drawHangman(data.wrong);
        listenToGame(id);
        linkEl.innerHTML = `Dela denna l√§nk: <a href="${location.origin}${location.pathname}?game=${id}">${location.origin}${location.pathname}?game=${id}</a>`;
      });
    }

    function showWord(word, guesses) {
      guesses = guesses || [];
      wordDiv.textContent = word.split("").map(l => guesses.includes(l) ? l : "_").join(" ");
    }

    function createLetterButtons(id) {
      lettersDiv.innerHTML = "";
      letters.forEach(letter => {
        const btn = document.createElement("button");
        btn.textContent = letter;
        btn.addEventListener("click", async () => {
          const snap = await db.ref("games/" + id).get();
          const data = snap.val();
          if (!data || data.over) return;
          const myRole = nickname === "Axwell" ? "host" : "guest";
          if (data.turn !== myRole) {
            alert("Det √§r inte din tur!");
            return;
          }
          btn.disabled = true;
          if (!data.guesses.includes(letter)) {
            data.guesses.push(letter);
            if (!data.word.includes(letter)) data.wrong++;
            if (data.wrong >= 6 || data.word.split("").every(l => data.guesses.includes(l))) data.over = true;
            await db.ref("games/" + id).set(data);
          }
        });
        lettersDiv.appendChild(btn);
      });
    }

    function listenToGame(id) {
      db.ref("games/" + id).on("value", snap => {
        const data = snap.val();
        if (!data) return;

        showWord(data.word, data.guesses);
        drawHangman(data.wrong);

        // Lobby display
        const players = data.players || {};
        const guestJoined = !!players.guest;
        lobbyDiv.innerHTML = `
          <strong>Spelare i lobbyn:</strong><br>
          üßë ${players.host || "Ok√§nd"} (v√§rd)<br>
          üë§ ${players.guest || "Ingen ansluten √§nnu"}<br><br>
          ${guestJoined ? (data.turn === "host" ? "üî§ G√§stens tur att gissa!" : "‚úçÔ∏è V√§rden v√§ljer ord!") : "‚è≥ V√§ntar p√• spelare ..."}
        `;

        // Turn indicator
        const myRole = nickname === "Axwell" ? "host" : "guest";
        if (data.turn === myRole) {
          turnIndicator.textContent = "üéØ Din tur att gissa!";
          turnIndicator.style.color = "green";
          turnIndicator.classList.remove("blink");
        } else {
          turnIndicator.innerHTML = "‚è≥ V√§nta p√• din tur <span class='blink'>üëÄ</span>";
          turnIndicator.style.color = "gray";
        }

        // Disable already guessed letters
        document.querySelectorAll("#letters button").forEach(b => {
          if (data.guesses.includes(b.textContent)) b.disabled = true;
        });

        // End-of-game messages
        if (data.over) {
          msg.textContent = data.wrong >= 6
            ? `üíÄ Du f√∂rlorade! Ordet var ${data.word}`
            : "üéâ Du vann!";
          restartBtn.style.display = "inline-block";
          newWordBtn.style.display = "inline-block";
        } else {
          msg.textContent = "";
          restartBtn.style.display = "none";
          newWordBtn.style.display = "none";
        }
      });
    }

    function drawHangman(wrong) {
      const cw = canvas.clientWidth, ch = canvas.clientHeight;
      canvas.width = cw; canvas.height = ch;
      const sX = cw / 200, sY = ch / 250;
      ctx.clearRect(0, 0, cw, ch);
      ctx.lineWidth = 2 * Math.min(sX, sY);
      ctx.beginPath();
      ctx.moveTo(10*sX,240*sY); ctx.lineTo(190*sX,240*sY);
      ctx.moveTo(50*sX,240*sY); ctx.lineTo(50*sX,20*sY);
      ctx.lineTo(130*sX,20*sY); ctx.lineTo(130*sX,50*sY); ctx.stroke();
      if(wrong>0){ctx.beginPath();ctx.arc(130*sX,70*sY,20*sX,0,Math.PI*2);ctx.stroke();}
      if(wrong>1){ctx.moveTo(130*sX,90*sY);ctx.lineTo(130*sX,160*sY);ctx.stroke();}
      if(wrong>2){ctx.moveTo(130*sX,110*sY);ctx.lineTo(100*sX,140*sY);ctx.stroke();}
      if(wrong>3){ctx.moveTo(130*sX,110*sY);ctx.lineTo(160*sX,140*sY);ctx.stroke();}
      if(wrong>4){ctx.moveTo(130*sX,160*sY);ctx.lineTo(110*sX,200*sY);ctx.stroke();}
      if(wrong>5){ctx.moveTo(130*sX,160*sY);ctx.lineTo(150*sX,200*sY);ctx.stroke();}
    }

    restartBtn.onclick = async () => {
      const snap = await db.ref("games/" + gameId).get();
      const data = snap.val();
      if (!data) return;
      data.guesses = [];
      data.wrong = 0;
      data.over = false;
      await db.ref("games/" + gameId).set(data);
    };

    newWordBtn.onclick = async () => {
      const newWord = prompt("Ange ett nytt ord:").toUpperCase();
      if (!newWord.match(/^[A-Z√Ö√Ñ√ñ]+$/)) {
        alert("Endast bokst√§ver (A-√ñ) till√•tna!");
        return;
      }
      const snap = await db.ref("games/" + gameId).get();
      const data = snap.val();
      const nextTurn = data.turn === "host" ? "guest" : "host";
      await db.ref("games/" + gameId).set({
        word: newWord,
        guesses: [],
        wrong: 0,
        over: false,
        players: data.players,
        turn: nextTurn
      });
    };

  }; // window.onload
  </script>
</body>
</html>
