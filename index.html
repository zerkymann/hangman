<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>H√ÑNGA GUBBE</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>

  <style>
:root {
  --bg1: #0d0d0f;
  --bg2: #1a1a1f;
  --panel: rgba(255,255,255,0.05);
  --accent: #f5a623;
  --accent2: #f57c00;
  --text: #ffffff;
  --text-dim: #bbbbbb;
}

/* üü° Full layout */
body {
  font-family: "Poppins", sans-serif;
  background: linear-gradient(-45deg, #0d0d0f, #1a1a1f, #161616, #1a1a1f);
  background-size: 400% 400%;
  animation: gradientShift 18s ease infinite;
  color: var(--text);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100dvh;
  margin: 0;
  overflow: hidden;
  padding: 0 10px;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

#gameContainer {
  background: var(--panel);
  backdrop-filter: blur(12px);
  border-radius: 20px;
  box-shadow: 0 0 25px rgba(0,0,0,0.6);
  width: 100%;
  max-width: 500px;
  height: 95%;
  max-height: 95dvh;
  padding: 16px;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  overflow: hidden;
}

/* üî† Typography */
h1 {
  font-weight: 600;
  color: var(--accent);
  letter-spacing: 1px;
  margin: 0;
  text-shadow: 0 0 10px rgba(245,166,35,0.6);
  font-size: clamp(1.4rem, 5vw, 1.8rem);
}

/* üßÆ Scoreboard */
#scoreboard {
  background: rgba(255,255,255,0.08);
  border-radius: 12px;
  padding: 6px 10px;
  font-weight: 600;
  display: flex;
  justify-content: space-around;
  color: var(--accent);
  font-size: clamp(0.8rem, 3.5vw, 1rem);
}

/* ‚úèÔ∏è Canvas (auto-scale) */
#hangman {
  flex-grow: 1;
  width: 100%;
  max-width: 280px;
  aspect-ratio: 200 / 250;
  background: #111;
  border: 1px solid #333;
  border-radius: 8px;
  margin: 10px auto;
  display: block;
}

/* üî° Word and Keyboard */
#word {
  font-size: clamp(1.2rem, 5vw, 1.8rem);
  letter-spacing: 0.25em;
  margin: 8px 0;
  word-break: break-word;
}

#letters {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 4px;
  margin: 8px 0;
  overflow-y: auto;
  max-height: 25%;
  padding-bottom: 5px;
}

#letters button {
  flex: 0 0 calc(11% - 4px);
  padding: 0.5rem 0.2rem;
  font-size: clamp(0.8rem, 3vw, 1rem);
  background: var(--accent);
  border: none;
  border-radius: 6px;
  color: #111;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

#letters button:hover:not(:disabled) {
  background: var(--accent2);
  transform: translateY(-2px);
}

#letters button:disabled {
  opacity: 0.3;
  cursor: default;
}

/* üí¨ Text and Lobby */
#turnIndicator, #message, #lobby, #link {
  font-size: clamp(0.85rem, 3.2vw, 1rem);
}

#turnIndicator {
  font-weight: 600;
  margin-bottom: 8px;
}

#message {
  color: var(--accent);
  transition: opacity 0.4s ease;
}

#lobby {
  margin-top: 5px;
  color: var(--text-dim);
  line-height: 1.3;
}

#link {
  color: var(--accent);
  word-break: break-all;
  margin-top: 8px;
  font-size: clamp(0.7rem, 3vw, 0.9rem);
}

/* üì± Inputs & Buttons */
input, button {
  font-family: "Poppins", sans-serif;
  border: none;
  border-radius: 8px;
  padding: 0.8rem 1rem;
  font-size: clamp(0.9rem, 3.5vw, 1rem);
  margin: 5px;
  outline: none;
}

#wordInput {
  width: 70%;
  background: #222;
  color: var(--text);
  border: 1px solid #333;
}

#createBtn, #restartBtn, #newWordBtn {
  background: var(--accent);
  color: #111;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

#createBtn:hover, #restartBtn:hover, #newWordBtn:hover {
  background: var(--accent2);
  transform: translateY(-2px);
}

#restartBtn, #newWordBtn {
  display: none;
  margin-top: 5px;
}

.blink {
  animation: blink 1.5s infinite;
}

@keyframes blink {
  0%, 90%, 100% { opacity: 1; }
  95% { opacity: 0.2; }
}
    /* ‚ú® Pulse animation for active player's turn */
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(245,166,35, 0.4); }
  70% { box-shadow: 0 0 0 8px rgba(245,166,35, 0); }
  100% { box-shadow: 0 0 0 0 rgba(245,166,35, 0); }
}

#letters.activeTurn button:not(:disabled) {
  animation: pulse 1.5s infinite;
}
</style>
</head>
<body>
  <div id="gameContainer">
    <h1>H√ÑNGA GUBBE</h1>
    <div id="setup">
      <input id="wordInput" placeholder="Skriv ett ord..." />
      <button id="createBtn">Skapa spel</button>
    </div>

    <div id="game" style="display:none;">
      <div id="scoreboard">
        üßë Axwell: <span id="scoreHost">0</span> &nbsp;|&nbsp; üë§ G√§st: <span id="scoreGuest">0</span>
      </div>
      <canvas id="hangman"></canvas>
      <div id="word"></div>
      <div id="turnIndicator"></div>
      <div id="letters"></div>
      <div id="message"></div>
      <div id="lobby"></div>
      <p id="link"></p>
      <button id="restartBtn">üîÅ Spela igen</button>
      <button id="newWordBtn">‚úçÔ∏è V√§lj nytt ord</button>
    </div>
  </div>

  <script>
  window.onload = () => {
    const firebaseConfig = {
      apiKey: "AIzaSyAN9URR47HIBwIuBP3kSu5Rv_Ys0ef72-Q",
      authDomain: "hangman-6a99e.firebaseapp.com",
      databaseURL: "https://hangman-6a99e-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "hangman-6a99e",
      storageBucket: "hangman-6a99e.firebasestorage.app",
      messagingSenderId: "992689481911",
      appId: "1:992689481911:web:6461e931ba4d96879ec532",
      measurementId: "G-W1HFVTC23L"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // üß† Presence system
    const connectedRef = db.ref(".info/connected");
    function setupPresence(gameId, role) {
      connectedRef.on("value", (snap) => {
        if (snap.val() === true) {
          const playerRef = db.ref(`games/${gameId}/players/${role}`);
          playerRef.onDisconnect().remove();
        }
      });
    }

    const setup = document.getElementById("setup");
    const gameDiv = document.getElementById("game");
    const wordDiv = document.getElementById("word");
    const lettersDiv = document.getElementById("letters");
    const msg = document.getElementById("message");
    const lobbyDiv = document.getElementById("lobby");
    const linkEl = document.getElementById("link");
    const restartBtn = document.getElementById("restartBtn");
    const newWordBtn = document.getElementById("newWordBtn");
    const canvas = document.getElementById("hangman");
    const ctx = canvas.getContext("2d");
// üß© Auto-scale the canvas dynamically for mobile + desktop
function resizeCanvas() {
  // height of the visible game area
  const containerHeight = gameDiv.clientHeight;
  // use about 30% of available height for hangman
  const available = containerHeight * 0.3;

  // width scales to 70% of screen width, but max 280px
  const width = Math.min(window.innerWidth * 0.7, 280);

  // height proportional to width, but never taller than available space
  const height = Math.min(available, width * 1.25);

  // apply to canvas
  canvas.width = width;
  canvas.height = height;

  // redraw base hangman so it‚Äôs visible
  drawHangman(0);
}

// update on window resize or rotation
window.addEventListener("resize", resizeCanvas);

// run once at start
resizeCanvas();
    const turnIndicator = document.getElementById("turnIndicator");
    const scoreHostEl = document.getElementById("scoreHost");
    const scoreGuestEl = document.getElementById("scoreGuest");

    const letters = [..."ABCDEFGHIJKLMNOPQRSTUVWXYZ√Ö√Ñ√ñ"];
    const urlParams = new URLSearchParams(window.location.search);
    const gameId = urlParams.get("game");

    let nickname = "Axwell";
    let isHost = false;

    // üß≠ Host creates game
    const createBtn = document.getElementById("createBtn");
    createBtn.addEventListener("click", async () => {
      try {
        const word = document.getElementById("wordInput").value.trim().toUpperCase();
        if (!word.match(/^[A-Z√Ö√Ñ√ñ]+$/)) {
          alert("Endast bokst√§ver (A‚Äì√ñ) till√•tna!");
          return;
        }
        const id = "hangman-" + Math.random().toString(36).substr(2, 5);
        await db.ref("games/" + id).set({
          word,
          guesses: [],
          wrong: 0,
          over: false,
          players: { host: "Axwell" },
          turn: "guest",
          scores: { host: 0, guest: 0 }
        });
        localStorage.setItem("createdGameId", id);
        window.location.href = `${location.origin}${location.pathname}?game=${id}`;
      } catch (err) {
        alert("Kunde inte skapa spelet. Kontrollera Firebase-konfigurationen.");
      }
    });

    // üéÆ Join existing game
    if (gameId) {
      setup.style.display = "none";
      gameDiv.style.display = "block";
      db.ref("games/" + gameId).get().then(async snap => {
        if (!snap.exists()) return (msg.textContent = "‚ùå Spelet kunde inte hittas.");
        const data = snap.val();
        const isCreator = data.players?.guest && localStorage.getItem("createdGameId") === gameId;
        isHost = isCreator;
        if (!isCreator) {
          nickname = localStorage.getItem("hangmanNick") || prompt("Ange ditt namn:") || "G√§st";
          localStorage.setItem("hangmanNick", nickname);
          await db.ref(`games/${gameId}/players/guest`).set(nickname);
        } else nickname = "Axwell";
        const role = isCreator ? "host" : "guest";
        if (role === "guest") setupPresence(gameId, role);
        startGame(gameId);
      });
    }

    function showFadeMessage(text, duration = 2500) {
      msg.textContent = text;
      msg.classList.remove("fade");
      setTimeout(() => msg.classList.add("fade"), duration);
    }

    function startGame(id) {
      db.ref("games/" + id).on("value", snap => {
        const data = snap.val();
        if (!data) return;
        const guesses = Array.isArray(data.guesses) ? data.guesses : [];
        showWord(data.word, guesses);
        drawHangman(data.wrong || 0);
        scoreHostEl.textContent = data.scores?.host || 0;
        scoreGuestEl.textContent = data.scores?.guest || 0;

        const players = data.players || {};
        const guestJoined = !!players.guest;
        lobbyDiv.innerHTML = `
          üßë ${players.host || "Ok√§nd"} (v√§rd)<br>
          üë§ ${players.guest || "Ingen ansluten √§nnu"}<br><br>
          ${guestJoined ? "üéÆ B√•da spelare anslutna!" : "‚è≥ V√§ntar p√• spelare ..."}
        `;
        if (!guestJoined) showFadeMessage("üõë Spelaren l√§mnade spelet!");

        const myRole = nickname === "Axwell" ? "host" : "guest";
if (data.turn === myRole) {
  turnIndicator.textContent = "üéØ Din tur att gissa!";
  turnIndicator.style.color = "#f5a623";
  turnIndicator.classList.remove("blink");

  // üü° Add gentle pulse to the keyboard
  lettersDiv.classList.add("activeTurn");
} else {
  turnIndicator.innerHTML = "‚è≥ V√§nta p√• din tur <span class='blink'>üëÄ</span>";
  turnIndicator.style.color = "#888";

  // üîµ Stop pulse when it's not your turn
  lettersDiv.classList.remove("activeTurn");
}
        const allBtns = document.querySelectorAll("#letters button");
        allBtns.forEach(b => (b.disabled = false));
        allBtns.forEach(b => {
          if (guesses.includes(b.textContent)) b.disabled = true;
        });

        if (data.over) {
          msg.textContent = data.wrong >= 6 ? `üíÄ Du f√∂rlorade! Ordet var ${data.word}` : "üéâ Du vann!";
          restartBtn.style.display = "inline-block";
          newWordBtn.style.display = "inline-block";
        } else {
          restartBtn.style.display = "none";
          newWordBtn.style.display = "none";
        }
      });
    }

    function showWord(word, guesses) {
      guesses = guesses || [];
      wordDiv.textContent = word.split("").map(l => guesses.includes(l) ? l : "_").join(" ");
    }

    function createLetterButtons(id) {
      lettersDiv.innerHTML = "";
      letters.forEach(letter => {
        const btn = document.createElement("button");
        btn.textContent = letter;
        btn.addEventListener("click", async () => {
          const snap = await db.ref("games/" + id).get();
          const data = snap.val() || {};
          if (!data.word) return alert("Spelet √§r inte laddat √§n!");
          data.guesses = Array.isArray(data.guesses) ? data.guesses : [];
          if (data.over) return;

          const myRole = nickname === "Axwell" ? "host" : "guest";
          if (data.turn !== myRole) return alert("Inte din tur!");

          btn.disabled = true;
          if (!data.guesses.includes(letter)) {
            data.guesses.push(letter);
            if (!data.word.includes(letter)) data.wrong++;
            const allFound = data.word.split("").every(l => data.guesses.includes(l));
            if (data.wrong >= 6 || allFound) {
              data.over = true;
              if (data.wrong < 6) data.scores[data.turn] += 1;
            }
            await db.ref("games/" + id).update({
              guesses: data.guesses,
              wrong: data.wrong,
              over: data.over,
              scores: data.scores
            });
          }
        });
        lettersDiv.appendChild(btn);
      });
    }

    function drawHangman(wrong) {
      const cw = canvas.clientWidth, ch = canvas.clientHeight;
      canvas.width = cw; canvas.height = ch;
      const sX = cw / 200, sY = ch / 250;
      ctx.clearRect(0, 0, cw, ch);
      ctx.lineWidth = 2 * Math.min(sX, sY);
      ctx.strokeStyle = "#f5a623";
      ctx.beginPath();
      ctx.moveTo(10*sX,240*sY); ctx.lineTo(190*sX,240*sY);
      ctx.moveTo(50*sX,240*sY); ctx.lineTo(50*sY,20*sY);
      ctx.lineTo(130*sX,20*sY); ctx.lineTo(130*sX,50*sY); ctx.stroke();
      if(wrong>0){ctx.beginPath();ctx.arc(130*sX,70*sY,20*sX,0,Math.PI*2);ctx.stroke();}
      if(wrong>1){ctx.moveTo(130*sX,90*sY);ctx.lineTo(130*sX,160*sY);ctx.stroke();}
      if(wrong>2){ctx.moveTo(130*sX,110*sY);ctx.lineTo(100*sX,140*sY);ctx.stroke();}
      if(wrong>3){ctx.moveTo(130*sX,110*sY);ctx.lineTo(160*sX,140*sY);ctx.stroke();}
      if(wrong>4){ctx.moveTo(130*sX,160*sY);ctx.lineTo(110*sX,200*sY);ctx.stroke();}
      if(wrong>5){ctx.moveTo(130*sX,160*sY);ctx.lineTo(150*sX,200*sY);ctx.stroke();}
    }

    restartBtn.onclick = async () => {
      const snap = await db.ref("games/" + gameId).get();
      const data = snap.val();
      if (!data) return;
      await db.ref("games/" + gameId).update({ guesses: [], wrong: 0, over: false });
      createLetterButtons(gameId);
    };

    newWordBtn.onclick = async () => {
      const snap = await db.ref("games/" + gameId).get();
      const data = snap.val();
      if (!data?.over) return alert("Rundan √§r inte slut √§n!");
      const newWord = (prompt("Ange nytt ord:") || "").toUpperCase();
      if (!newWord.match(/^[A-Z√Ö√Ñ√ñ]+$/)) return alert("Endast bokst√§ver (A‚Äì√ñ) till√•tna!");
      const nextTurn = data.turn === "host" ? "guest" : "host";
      await db.ref("games/" + gameId).set({
        word: newWord,
        guesses: [],
        wrong: 0,
        over: false,
        players: data.players,
        turn: nextTurn,
        scores: data.scores
      });
      createLetterButtons(gameId);
    };
  };
  </script>
</body>
</html>
