<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multiplayer Hangman</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f4f4f4; margin: 0; padding: 0; }
    h1 { margin-top: 20px; }
    #word { font-size: 2rem; letter-spacing: 5px; margin: 20px; }
    #letters button { margin: 5px; padding: 10px; font-size: 1.2rem; cursor: pointer; }
    #link { margin: 10px; color: blue; }
    #hangmanCanvas { margin: 20px auto; display: block; background: #fff; border: 1px solid #ccc; }
    #restartBtn { display: none; margin-top: 15px; padding: 10px 15px; font-size: 1rem; cursor: pointer; }
  </style>
</head>
<body>
  <h1>ğŸ”¤ Multiplayer Hangman</h1>

  <div id="setup">
    <input id="wordInput" placeholder="Enter a word for your friend..." />
    <button id="createBtn">Create Game</button>
  </div>

  <div id="game" style="display:none;">
    <canvas id="hangmanCanvas" width="200" height="250"></canvas>
    <div id="word"></div>
    <div id="letters"></div>
    <div id="message"></div>
    <p id="link"></p>
    <button id="restartBtn">ğŸ” Restart Game</button>
  </div>

  <script>
    // ğŸ”¥ Initialize Firebase (insert your config here)
    const firebaseConfig = {
  apiKey: "AIzaSyAN9URR47HIBwIuBP3kSu5Rv_Ys0ef72-Q",
  authDomain: "hangman-6a99e.firebaseapp.com",
  databaseURL: "https://hangman-6a99e-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "hangman-6a99e",
  storageBucket: "hangman-6a99e.firebasestorage.app",
  messagingSenderId: "992689481911",
  appId: "1:992689481911:web:6461e931ba4d96879ec532",
  measurementId: "G-W1HFVTC23L"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const setup = document.getElementById("setup");
    const gameDiv = document.getElementById("game");
    const wordDiv = document.getElementById("word");
    const lettersDiv = document.getElementById("letters");
    const msg = document.getElementById("message");
    const linkEl = document.getElementById("link");
    const restartBtn = document.getElementById("restartBtn");
    const canvas = document.getElementById("hangmanCanvas");
    const ctx = canvas.getContext("2d");

    const urlParams = new URLSearchParams(window.location.search);
    const gameId = urlParams.get("game");
    let isHost = false;

    // ğŸ§­ If URL has a game ID â†’ join
    if (gameId) {
      setup.style.display = "none";
      gameDiv.style.display = "block";
      startGuessing(gameId);
    }

    // âœ¨ Create game (and auto redirect host to their own room)
    document.getElementById("createBtn").onclick = async () => {
      const word = document.getElementById("wordInput").value.toUpperCase();
      if (!word.match(/^[A-Z]+$/)) return alert("Letters only!");
      const id = "hangman-" + Math.random().toString(36).substr(2, 5);
      isHost = true;
      await db.ref("games/" + id).set({
        word,
        guesses: [],
        wrong: 0,
        over: false
      });
      window.location.href = `${location.origin}${location.pathname}?game=${id}`;
    };

    // ğŸ® Join or continue game
    function startGuessing(id) {
      db.ref("games/" + id).get().then(snap => {
        if (!snap.exists()) {
          msg.textContent = "Game not found.";
          return;
        }
        const data = snap.val();
        if (!Array.isArray(data.guesses)) data.guesses = [];
        showWord(data.word, data.guesses);
        drawHangman(data.wrong);
        createLetterButtons(id);
        listenToGame(id);
      });

      // Host check (if host is also in the room)
      if (isHost || !urlParams.get("game")) {
        restartBtn.style.display = "block";
        restartBtn.onclick = () => restartGame(id);
      }
    }

    // ğŸ“ Show current word with blanks
    function showWord(word, guesses) {
      guesses = Array.isArray(guesses) ? guesses : [];
      wordDiv.textContent = word
        .split("")
        .map(l => guesses.includes(l) ? l : "_")
        .join(" ");
    }

    // ğŸ”  Create Aâ€“Z letter buttons
    function createLetterButtons(id) {
      lettersDiv.innerHTML = "";
      for (let i = 65; i <= 90; i++) {
        const letter = String.fromCharCode(i);
        const btn = document.createElement("button");
        btn.textContent = letter;
        btn.onclick = async () => {
          btn.disabled = true;
          const snap = await db.ref("games/" + id).get();
          const data = snap.val();
          if (!data || data.over) return;
          if (!data.guesses.includes(letter)) {
            data.guesses.push(letter);
            if (!data.word.includes(letter)) data.wrong++;
            if (data.wrong >= 6 || data.word.split("").every(l => data.guesses.includes(l))) data.over = true;
            await db.ref("games/" + id).set(data);
          }
        };
        lettersDiv.appendChild(btn);
      }
    }

    // ğŸ‘‚ Listen for real-time game updates
    function listenToGame(id) {
      db.ref("games/" + id).on("value", snap => {
        const data = snap.val();
        if (!data) return;
        showWord(data.word, data.guesses);
        drawHangman(data.wrong);
        if (data.over) {
          msg.textContent = data.wrong >= 6 ? `ğŸ’€ You lost! Word was ${data.word}` : "ğŸ‰ You won!";
          document.querySelectorAll("#letters button").forEach(b => (b.disabled = true));
        } else {
          msg.textContent = "";
        }
      });

      linkEl.innerHTML = `Share this link: <a href="?game=${id}">${location.origin}${location.pathname}?game=${id}</a>`;
    }

    // ğŸ” Restart game (host only)
    function restartGame(id) {
      const newWord = prompt("Enter a new word to restart:").toUpperCase();
      if (!newWord.match(/^[A-Z]+$/)) return alert("Letters only!");
      db.ref("games/" + id).set({
        word: newWord,
        guesses: [],
        wrong: 0,
        over: false
      });
      showWord(newWord, []);
      drawHangman(0);
      createLetterButtons(id);
      msg.textContent = "";
    }

    // ğŸªœ Draw hangman graphics based on wrong guesses
    function drawHangman(wrong) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.lineWidth = 2;
      ctx.strokeStyle = "#000";

      // Base gallows
      ctx.beginPath();
      ctx.moveTo(10, 240); ctx.lineTo(190, 240);
      ctx.moveTo(50, 240); ctx.lineTo(50, 20);
      ctx.lineTo(130, 20); ctx.lineTo(130, 50);
      ctx.stroke();

      if (wrong > 0) { // Head
        ctx.beginPath();
        ctx.arc(130, 70, 20, 0, Math.PI * 2);
        ctx.stroke();
      }
      if (wrong > 1) { // Body
        ctx.beginPath();
        ctx.moveTo(130, 90); ctx.lineTo(130, 150);
        ctx.stroke();
      }
      if (wrong > 2) { // Left arm
        ctx.beginPath();
        ctx.moveTo(130, 100); ctx.lineTo(100, 130);
        ctx.stroke();
      }
      if (wrong > 3) { // Right arm
        ctx.beginPath();
        ctx.moveTo(130, 100); ctx.lineTo(160, 130);
        ctx.stroke();
      }
      if (wrong > 4) { // Left leg
        ctx.beginPath();
        ctx.moveTo(130, 150); ctx.lineTo(110, 200);
        ctx.stroke();
      }
      if (wrong > 5) { // Right leg
        ctx.beginPath();
        ctx.moveTo(130, 150); ctx.lineTo(150, 200);
        ctx.stroke();
      }
    }
  </script>
</body>
</html>
